================================================================================
SMART KANBAN - CHANGELOG
Date: 2026-01-19
================================================================================

VERSION 0.3.6 - Generalized New Content Detection for All Content Types
--------------------------------------------------------------------------------

[NEW] Generalized New Content Detection
- Extended "new content" detection beyond TV series to ALL content types
- Strategy pattern architecture for type-specific detection logic
- Content-specific badge labels based on content kind

NEW CONTENT SIGNALS BY TYPE:
- TV Series: New seasons on TMDb vs checklist, upcoming seasons via next_episode_to_air
- Movies: Sequel detection in franchise via TMDb belongs_to_collection
- Anime: Sequel detection via Jikan relations API + season tracking
- Books: New books in series or by same author via Open Library
- Games: Sequel/DLC detection via RAWG game-series endpoint

[NEW] Content-Specific Badge Labels
- "NEW SEASON" - For TV series and anime with new seasons
- "SEQUEL" - For movies, anime, and games with sequels available
- "NEW BOOK" - For book series with new entries
- "DLC" - For games with new DLC/expansions
- "NEW RELEASE" - For related content by same author
- "UPCOMING" - For any content with future release date

[NEW] Generic UpcomingContent Interface
- contentKind: 'season' | 'sequel' | 'book' | 'dlc' | 'related' | 'episode'
- title: Display title (e.g., "Season 4", "The Dark Knight Rises")
- releaseDate: Optional ISO date string
- description: Optional additional info
- source: 'tmdb' | 'jikan' | 'openlibrary' | 'rawg'
- seasonNumber/episodeNumber/seriesPosition: Type-specific metadata

[NEW] Detection Strategy Architecture
- NewContentDetector.ts: Base interfaces and helper functions
- NewContentOrchestrator.ts: Strategy registry and routing
- TVSeriesStrategy.ts: Compares checklist seasons vs TMDb
- MovieStrategy.ts: Checks franchise for unreleased sequels
- AnimeStrategy.ts: Checks seasons + Jikan related for sequels
- BookStrategy.ts: Checks series position and author releases
- GameStrategy.ts: Checks series for newer games/DLC

[REFACTOR] useNewContentScanner Hook
- Now supports all content types, not just TV series
- Uses AgentOrchestrator.enrich() for type-appropriate API calls
- Uses NewContentOrchestrator.detect() for type-specific detection
- Generic UpcomingContent storage on tasks

[FIX] Universal Import Enrichment
- Import process now enriches ALL content types (movies, books, games, etc.)
- Previously only TV series cards with season checklists were enriched during import
- Now uses AgentOrchestrator.enrich() for type-appropriate API calls
- Uses NewContentOrchestrator.detect() for new content detection
- Movies now get sequel detection, books get series detection, etc.

[UPDATE] UI Badge Rendering
- Dynamic badge text based on upcomingContent.contentKind
- Uses getContentKindLabel() helper for display text
- Uses isUpcoming() helper to determine "UPCOMING" vs released

[FIX] Data Persistence Race Condition
- Fixed bug where refreshing the app could lose all data
- Added hasLoaded flag to prevent save effect from running before load completes
- Ensures localStorage is not overwritten with empty state during initial mount

--------------------------------------------------------------------------------

FILES MODIFIED:
- src/engine/types.ts (added UpcomingContent, UpcomingContentKind, UpcomingContentSource)
- src/engine/index.ts (new exports for types and detection module)
- src/hooks/useNewContentScanner.ts (refactored for all content types)
- src/App.tsx (updated TaskItem interface, badge rendering, imports)
- src/components/TaskDetailModal.tsx (updated TaskItem interface)
- CHANGELOG.md (updated)
- TODO.md (marked generalized detection complete)

FILES ADDED:
- src/engine/detection/NewContentDetector.ts (base interfaces and helpers)
- src/engine/detection/NewContentOrchestrator.ts (strategy orchestrator)
- src/engine/detection/index.ts (module exports)
- src/engine/detection/strategies/TVSeriesStrategy.ts
- src/engine/detection/strategies/MovieStrategy.ts
- src/engine/detection/strategies/AnimeStrategy.ts
- src/engine/detection/strategies/BookStrategy.ts
- src/engine/detection/strategies/GameStrategy.ts
- src/changelogs/changelog-2026-01-19.txt (this file)

--------------------------------------------------------------------------------

SESSION 2: Column Reordering & Cross-Tab Sync
--------------------------------------------------------------------------------

[NEW] Drag & Drop Column Reordering
- Columns/lists can now be reordered by dragging their headers
- Visual preview shows column being dragged with first 3 cards
- Column order persists to localStorage (survives page reload)
- Stored in goal.columnOrder property

[NEW] Cross-Tab Real-Time Sync
- Changes now sync between browser tabs instantly
- Uses localStorage storage event listener
- Changes in one tab appear immediately in other tabs
- No manual refresh needed

[NEW] 24-Hour API Cache
- Enrichment API responses cached for 24 hours per task
- Refresh button uses cache, only hits API if cache > 24 hours old
- Reduces unnecessary API calls to preserve free tier limits
- Cache stored in task.cachedEnrichment with fetchedAt timestamp

[FIX] Stable Column Order During Card Drags
- Columns no longer shift position when cards move between them
- Per-column SortableContext ensures only cards in same column shift
- Column order tracked separately from task grouping

[FIX] Card Drag Scroll Preservation
- Board scroll position preserved when dragging cards
- Scroll position saved on drag start, restored on drag end
- Prevents board from jumping when dropping cards

[FIX] Column Drag Scroll Lock
- Board scroll locked during column drags
- Prevents unwanted horizontal scrolling when moving columns
- Scroll only occurs when dragging near viewport edges

[TECHNICAL] Drag & Drop Implementation
- SortableTaskColumn: Combined sortable + droppable component
- horizontalListSortingStrategy for column reordering
- verticalListSortingStrategy for card reordering (per-column)
- Conditional auto-scroll: disabled for columns, enabled for cards
- Scroll lock via dataset.lockedScroll and scroll event listener

FILES MODIFIED:
- src/App.tsx (column reordering, scroll preservation, cross-tab sync)
- src/hooks/useNewContentScanner.ts (24-hour cache, manual refresh)
- CHANGELOG.md (added new features)
- TODO.md (marked column reordering complete)

================================================================================
